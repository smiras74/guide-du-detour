<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Guide du D√©tour ¬∑ Map & Routing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    /* --- 1. GLOBAL VARIABLES --- */
    :root {
      /* DARK (Default) */
      --bg-color: #020617;
      --bg-gradient: radial-gradient(circle at 50% -20%, #1e293b 0%, #020617 80%);
      --text-main: #ffffff;
      --text-sub: #94a3b8;
      --text-muted: #64748b;
      --primary: #22c55e;
      --primary-grad: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      
      --glass-border: rgba(255,255,255,0.08);
      --glass-bg: rgba(255,255,255,0.03);
      --glass-blur: blur(12px);
      
      --card-bg: rgba(2, 6, 23, 0.85); /* Darker background for panels */
      
      --active-card-bg: rgba(34, 197, 94, 0.15);
      --active-text: #4ade80;
      
      --nav-bg: rgba(2, 6, 23, 0.85);
      
      --map-ui-bg: rgba(15, 23, 42, 0.9);
    }

    /* LIGHT THEME */
    [data-theme="light"] {
      --bg-color: #ffffff;
      --bg-gradient: linear-gradient(to bottom, #ffffff 0%, #f8fafc 100%);
      --text-main: #0f172a;
      --text-sub: #475569;
      --text-muted: #94a3b8;
      
      --glass-border: rgba(0,0,0,0.08);
      --glass-bg: rgba(255,255,255,0.9);
      
      --card-bg: #ffffff;
      --active-card-bg: #dcfce7; 
      --active-text: #166534;
      --nav-bg: rgba(255, 255, 255, 0.95);
      
      --map-ui-bg: #ffffff;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { margin: 0; padding: 0; height: 100%; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, sans-serif; background: var(--bg-color); color: var(--text-main); -webkit-font-smoothing: antialiased; transition: background 0.3s ease, color 0.3s ease; }
    body { display: flex; justify-content: center; align-items: stretch; }
    .app-shell { width: 100%; max-width: 430px; height: 100vh; background: var(--bg-gradient); overflow: hidden; position: relative; transition: background 0.3s ease; }

    /* --- UI KIT --- */
    .btn-primary { width: 100%; padding: 16px; border-radius: 24px; border: none; background: var(--primary-grad); color: #020617; font-weight: 700; font-size: 16px; cursor: pointer; box-shadow: 0 8px 20px -6px rgba(34, 197, 94, 0.6); transform: scale(1); transition: 0.2s; }
    .btn-primary:active { transform: scale(0.97); opacity: 0.9; }
    ::-webkit-scrollbar { width: 0px; background: transparent; }
    
    /* ICONS */
    .icon { width: 24px; height: 24px; stroke-width: 2; stroke: currentColor; fill: none; transition: 0.3s; }
    .icon-sm { width: 18px; height: 18px; }
    .icon-lg { width: 32px; height: 32px; stroke-width: 1.5; }

    /* --- 2. SPLASH & 3. AUTH & 4. PROFILE (Hidden Logic) --- */
    /* (–î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ —Å—Ç–∏–ª–∏ Splash/Auth/Profile —Å–≤–µ—Ä–Ω—É—Ç—ã, –Ω–æ –æ–Ω–∏ –µ—Å—Ç—å, —á—Ç–æ–±—ã –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ) */
    #splash-screen, #auth-screen, #profile-screen { position: absolute; inset: 0; z-index: 100; display: flex; flex-direction: column; }
    #splash-screen { background: #020617; align-items: center; justify-content: center; padding: 30px; }
    .splash-logo { width: 280px; height: auto; margin-bottom: 8px; opacity: 0; animation: fadeUp 1s forwards 0.3s; }
    .splash-slogan { width: 280px; font-size: 12px; color: #94a3b8; text-align: center; margin-bottom: 40px; opacity: 0; animation: fadeUp 1s forwards 0.8s; }
    .splash-progress { width: 280px; height: 1px; border-radius: 99px; background: rgba(255,255,255,0.1); position: relative; opacity: 0; animation: fadeUp 1s forwards 0.1s; overflow: hidden; }
    .splash-progress-bar { position: absolute; inset: 0; background: var(--primary); transform: translateX(-100%); animation: splashBar 6s ease-in-out forwards; }
    
    /* Auth Styles Simplified */
    #auth-screen { padding: 32px; justify-content: center; background: var(--bg-color); z-index: 90; }
    h1.auth-title { font-size: 34px; font-weight: 800; margin: 0 0 10px; color: var(--text-main); }
    .input-field { width: 100%; padding: 18px 16px 14px; border-radius: 20px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: var(--text-main); font-size: 16px; margin-bottom: 16px; }
    
    /* Profile Styles Simplified */
    #profile-screen { background: var(--bg-color); overflow-y: auto; z-index: 95; }
    .profile-nav { display: flex; justify-content: space-between; padding: 16px 20px; background: var(--nav-bg); border-bottom: 1px solid var(--glass-border); }
    .profile-content { padding: 20px; }
    .settings-list { display: flex; flex-direction: column; gap: 20px; margin-top: 20px; }
    .segment-pill-wrap { background: var(--glass-bg); padding: 3px; border-radius: 99px; display: flex; gap: 2px; }
    .segment-pill { padding: 6px 12px; border-radius: 99px; border: none; background: transparent; font-size: 12px; color: var(--text-sub); }
    .segment-pill.active { background: var(--bg-color); color: var(--text-main); box-shadow: 0 2px 6px rgba(0,0,0,0.1); }

    @keyframes splashBar { 0% { transform: translateX(-100%); } 100% { transform: translateX(0%); } }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }


    /* --- 5. MAIN SCREEN (MAP) - NEW DESIGN --- */
    #main-screen { position: absolute; inset: 0; z-index: 10; display: none; }
    
    /* MAP CONTAINER */
    #map-container {
      position: absolute; inset: 0; z-index: 0;
      background: #0b1120; /* Fallback color */
    }
    /* Leaflet overrides */
    .leaflet-control-attribution { display: none; } /* Hide footer for clean look */

    /* TOP FLOATING SEARCH */
    .map-top-bar {
      position: absolute; top: 20px; left: 20px; right: 20px; z-index: 20;
      display: flex; flex-direction: column; gap: 8px;
    }
    
    .route-box {
      background: var(--map-ui-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(12px);
      border-radius: 24px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      display: flex; flex-direction: column; gap: 12px;
    }

    .route-row { display: flex; align-items: center; gap: 12px; }
    .route-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .dot-start { background: #3b82f6; box-shadow: 0 0 8px rgba(59, 130, 246, 0.5); }
    .dot-end { background: var(--primary); box-shadow: 0 0 8px rgba(34, 197, 94, 0.5); }
    
    .route-input {
      width: 100%; background: transparent; border: none;
      font-size: 15px; color: var(--text-main); font-weight: 500;
      padding: 4px 0;
    }
    .route-input::placeholder { color: var(--text-muted); }
    .route-input:focus { outline: none; }
    
    .divider-h { height: 1px; background: var(--glass-border); margin-left: 22px; }

    /* SIDE BUTTONS */
    .map-side-btns {
      position: absolute; right: 20px; top: 160px; z-index: 20;
      display: flex; flex-direction: column; gap: 12px;
    }
    .side-btn {
      width: 44px; height: 44px; border-radius: 50%;
      background: var(--map-ui-bg); border: 1px solid var(--glass-border);
      color: var(--text-main);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15); cursor: pointer;
      backdrop-filter: blur(4px); transition: 0.2s;
    }
    .side-btn:active { transform: scale(0.92); }

    /* BOTTOM COCKPIT (CONTROLS) */
    .map-bottom-panel {
      position: absolute; bottom: 0; left: 0; right: 0; z-index: 20;
      padding: 20px 24px 34px;
      background: linear-gradient(to top, var(--nav-bg) 80%, transparent);
      display: flex; flex-direction: column; gap: 16px;
    }

    /* AVOIDANCE BUTTONS ROW */
    .avoid-row {
      display: flex; gap: 10px; overflow-x: auto; padding-bottom: 4px;
      /* Hide scrollbar */
      -ms-overflow-style: none; scrollbar-width: none; 
    }
    .avoid-row::-webkit-scrollbar { display: none; }

    .avoid-btn {
      flex: 1;
      display: flex; align-items: center; justify-content: center; gap: 8px;
      padding: 10px 14px; border-radius: 16px;
      background: var(--map-ui-bg); border: 1px solid var(--glass-border);
      color: var(--text-sub); font-size: 12px; font-weight: 600;
      cursor: pointer; transition: 0.2s; white-space: nowrap;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    
    /* Active state = Excluded (Red/Orange warning or Green preference?) 
       Let's use "Active" color to mean "Option ON" (Avoidance ON) */
    .avoid-btn.active {
      background: rgba(239, 68, 68, 0.15); /* Redish tint */
      border-color: #ef4444;
      color: #ef4444;
    }
    .avoid-btn .icon { width: 16px; height: 16px; stroke-width: 2.5; }

    .go-btn-row { display: flex; gap: 12px; align-items: center; }
    .go-btn { flex: 1; }
    
    /* Avatar on map */
    .map-avatar-btn {
      width: 40px; height: 40px; border-radius: 50%;
      background: var(--map-ui-bg); border: 1px solid var(--glass-border);
      display: flex; align-items: center; justify-content: center;
      color: var(--text-main); font-weight: 700; cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

  </style>
</head>
<body>

<svg style="display: none;">
  <symbol id="icon-user" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></symbol>
  <symbol id="icon-loc" viewBox="0 0 24 24"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></symbol>
  <symbol id="icon-toll" viewBox="0 0 24 24"><rect x="2" y="6" width="20" height="12" rx="2"></rect><circle cx="12" cy="12" r="2"></circle><path d="M6 12h.01M18 12h.01"></path></symbol> <symbol id="icon-hwy" viewBox="0 0 24 24"><path d="M8 2L5 22"></path><path d="M16 2l3 20"></path><path d="M12 12h.01"></path><line x1="12" y1="2" x2="12" y2="22" stroke-dasharray="4 4"></line></symbol> <symbol id="icon-offroad" viewBox="0 0 24 24"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle></symbol> <symbol id="icon-close" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></symbol>
</svg>

<div class="app-shell">

  <div id="splash-screen">
    <img src="logo_2.png" alt="Guide du D√©tour" class="splash-logo" onerror="this.style.display='none';" />
    <div class="splash-slogan">√áa vaut le d√©tour ‚Äî √† chaque trajet.</div>
    <div class="splash-progress"><div class="splash-progress-bar"></div></div>
    <div class="loading-text">Chargement...</div>
  </div>

  <div id="auth-screen">
    <h1 class="auth-title">Bienvenue</h1>
    <div class="input-wrapper"><input class="input-field" id="email" placeholder="Email" /></div>
    <div class="input-wrapper"><input class="input-field" id="pwd" type="password" placeholder="Password" /></div>
    <button id="btn-auth-action" class="btn-primary">Entrer</button>
  </div>

  <div id="profile-screen">
    <div class="profile-nav">
      <button class="nav-btn" id="btn-profile-back"><svg class="icon"><use href="#icon-close"></use></svg></button>
      <span class="nav-title">Profil</span>
      <div style="width:24px;"></div>
    </div>
    <div class="profile-content">
      <div class="settings-list">
        <div class="segment-pill-wrap" id="theme-selector">
             <button class="segment-pill" data-val="auto">Auto</button>
             <button class="segment-pill" data-val="light">‚òÄÔ∏è Clair</button>
             <button class="segment-pill active" data-val="dark">üåë Sombre</button>
        </div>
      </div>
      <button id="btn-logout" class="btn-primary" style="margin-top:20px; background:#ef4444;">D√©connexion</button>
    </div>
  </div>

  <div id="main-screen">
    
    <div id="map-container"></div>

    <div class="map-top-bar">
      <div class="route-box">
        <div class="route-row">
          <div class="route-dot dot-start"></div>
          <input class="route-input" value="Ma position actuelle" placeholder="D√©part" />
        </div>
        <div class="divider-h"></div>
        <div class="route-row">
          <div class="route-dot dot-end"></div>
          <input class="route-input" id="destination-input" placeholder="O√π on va ?" />
        </div>
      </div>
    </div>

    <div class="map-side-btns">
      <button class="side-btn" id="btn-profile-open">
        <svg class="icon"><use href="#icon-user"></use></svg>
      </button>
      <button class="side-btn" id="btn-locate">
        <svg class="icon"><use href="#icon-loc"></use></svg>
      </button>
    </div>

    <div class="map-bottom-panel">
      
      <div class="avoid-row">
        <button class="avoid-btn" onclick="this.classList.toggle('active')">
          <svg class="icon"><use href="#icon-toll"></use></svg>
          P√©ages
        </button>
        <button class="avoid-btn" onclick="this.classList.toggle('active')">
          <svg class="icon"><use href="#icon-hwy"></use></svg>
          Autoroutes
        </button>
        <button class="avoid-btn" onclick="this.classList.toggle('active')">
          <svg class="icon"><use href="#icon-offroad"></use></svg>
          Chemins
        </button>
      </div>

      <div class="go-btn-row">
        <button class="btn-primary go-btn">Tracer l'itin√©raire</button>
      </div>
    </div>

  </div>

</div>

<script>
  /* --- LOGIC --- */
  const els = {
    splash: document.getElementById('splash-screen'),
    auth: document.getElementById('auth-screen'),
    profile: document.getElementById('profile-screen'),
    main: document.getElementById('main-screen'),
    mapContainer: document.getElementById('map-container')
  };

  let map = null;
  let tileLayer = null;

  // 1. INIT APP
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      els.splash.style.display = 'none';
      if(localStorage.getItem('gddLoggedIn')) {
        showScreen('main');
      } else {
        showScreen('auth');
      }
    }, 4000); // Splash time
  });

  function showScreen(name) {
    els.auth.style.display = 'none'; els.profile.style.display = 'none'; els.main.style.display = 'none';
    
    if(name === 'auth') els.auth.style.display = 'flex';
    if(name === 'profile') els.profile.style.display = 'flex';
    if(name === 'main') {
      els.main.style.display = 'block';
      setTimeout(initMap, 100); // Init map after div is visible
    }
  }

  // 2. MAP LOGIC
  function initMap() {
    if(map) {
        // Just update theme if map exists
        updateMapTheme();
        map.invalidateSize();
        return;
    }

    // Paris Default
    map = L.map('map-container', { zoomControl: false }).setView([48.8566, 2.3522], 13);
    updateMapTheme(); // Load correct tiles
  }

  function updateMapTheme() {
    if(!map) return;
    
    const isLight = document.documentElement.getAttribute('data-theme') === 'light';
    
    // CartoDB Tiles (Free, Clean)
    const darkUrl = 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png';
    const lightUrl = 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';
    
    const url = isLight ? lightUrl : darkUrl;

    if(tileLayer) map.removeLayer(tileLayer);
    
    tileLayer = L.tileLayer(url, {
        maxZoom: 20,
        attribution: '&copy; OpenStreetMap &copy; CARTO'
    }).addTo(map);
  }

  // 3. NAVIGATION LOGIC
  document.getElementById('btn-auth-action').addEventListener('click', () => {
    localStorage.setItem('gddLoggedIn', '1'); showScreen('main');
  });

  document.getElementById('btn-profile-open').addEventListener('click', () => showScreen('profile'));
  document.getElementById('btn-profile-back').addEventListener('click', () => showScreen('main'));
  
  document.getElementById('btn-logout').addEventListener('click', () => {
    localStorage.removeItem('gddLoggedIn'); showScreen('auth');
  });

  document.getElementById('btn-locate').addEventListener('click', () => {
    if(map) {
        map.locate({setView: true, maxZoom: 15});
        // Fake location effect for demo
        const btn = document.getElementById('btn-locate');
        btn.style.color = '#4ade80';
        setTimeout(() => btn.style.color = '', 2000);
    }
  });

  // 4. THEME SWITCHER
  const themeBtns = document.querySelectorAll('#theme-selector .segment-pill');
  themeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
          themeBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          const mode = btn.getAttribute('data-val');
          if(mode === 'light') document.documentElement.setAttribute('data-theme', 'light');
          else if (mode === 'dark') document.documentElement.removeAttribute('data-theme');
          else document.documentElement.removeAttribute('data-theme'); // Auto = Default Dark for now
          
          // Update Map Tiles immediately
          updateMapTheme();
      });
  });

</script>
</body>
</html>
